# Flume File-Sink
Сток Flume, позволяющий записывать события в файлы локальной файловой системы. Является альтернативой стандартного стока [File-Roll Sink](https://flume.apache.org/FlumeUserGuide.html#file-roll-sink). Основные отличия:
- Имя файла формируется на основе заголовка события (т.е. на стороне клиента или перехватчиками).
- Сток не управляет "нарезкой" файлов, сформировать файлы с ограничением по числу событий/размеру невозможно на уровне стока.
- Формируемые данные закрываются по таймауту бездействия (если события для данного файла не приходили некоторое время).
- Имя файла в заголовке может быть указано как отностительный путь - т.е. содержать имена подпапок.

Таким образом, формирование файлов и их структуры лежит полностью на стороне клиентов, т.к. они формируют имя файла для записи события.

# Пример конфигурации
```aconf
agent.sinks.file-sink.channel = memchannel
agent.sinks.file-sink.type = ru.flume.sink.FileSink

# Корневая папка для формируемых файлов
agent.sinks.file-sink.sink.dir = /data/sample
# Заголовок, в котором передается имя файла (default - 'file')
agent.sinks.file-sink.sink.fileNameHeader = file-name

# Количество обрабатываемых события за одну транзакцию
agent.sinks.file-sink.sink.batchSize = 5000 (default - 1000)
# Время бездействия файла (мс) - если за это время файл не получил ни одного нового события, он будет закрыт
agent.sinks.file-sink.sink.idleTimeout = 600000 (default - 3600000)
# Как часто сбрасывать буфер на жесткий диск - имеет смысл, когда необходимо посмотреть результат
# работы стока при небольшой интенсивности потока данных и длительном idleTimeout (default - 60000)
agent.sinks.file-sink.sink.flushTimeout = 600000
# Как часто проверять открытые файлы на предмет бездействия (default - 60000)
agent.sinks.file-sink.sink.checkPeriod = 5000

# Разделитель событий при записи в файл. По умолчанию - перенос строки для записи данных построчно (default - \n).
agent.sinks.file-sink.sink.eventSeparator = \n
# Расширение закрытых файлов (default - 'log')
agent.sinks.file-sink.sink.extension = txt
# Алгоритм сжатия ('gzip' или 'text'), можно указать свой класс-Compressor
# Compressor может устанавливать свое расширение для файла - в данном случае
# итоговый файл будет иметь расширение 'txt.gz' (default - 'text')
agent.sinks.file-sink.sink.compressor = gzip

# Параметры GZIPOutputStream
agent.sinks.file-sink.sink.compressor.gzip.bufferSize = 1024
agent.sinks.file-sink.sink.compressor.gzip.syncFlush = true
```

# Особенности
- Имя файла в заголовке события следует отправлять без расширения (**2015-11-11_00-00-00.my-file**)
- В имени файла можно указывать подпапки (**my/2015-11-11/2015-11-11_00-00-00.my-file**)
- Не начинайте имена файлов с подпапками со знака /
- На время записи файлу присваивается расширение **.tmp**
- Если файл с указанным именем существует, при закрытии ему будет присвоен индекс (**2015-11-11_00-00-00.my-file (1).txt**)

